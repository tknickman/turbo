name: Smoke Test Canary

on:
  workflow_dispatch:
  repository_dispatch:
    types:
      - webhook

jobs:
  test_matrix:
    name: "Smoke Test Canary"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        test: ["local", "global", "both"]
        packageManager: ["yarn", "pnpm"]
        
    steps:
      - name: Configure git
        run: |
          git config --global user.name 'Turbobot'
          git config --global user.email 'turbobot@vercel.com'
      - name: Setup pnpm
        uses: pnpm/action-setup@v2.2.4
        if: ${{ matrix.packageManager == 'pnpm' }}
        with:
          version: 7.12.1
      - name: Setup yarn
        if: ${{ matrix.packageManager == 'yarn' }}
        run: npm install -g yarn
      - name: Checkout test file
        uses: Bhacaz/checkout-files@v2
        with:
         files: scripts/smoke-canary.js
      - name: Run Test
        run: node scripts/smoke-canary.js ${{ matrix.test }} canary ${{ matrix.packageManager }}
